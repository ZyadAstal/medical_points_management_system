<!DOCTYPE html>

<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>مرضى اليوم - Medicare</title>
<link href="../css/style.css" rel="stylesheet"/>
</head>
<body data-page="today-patients">
<div class="app">
<iframe class="sidebar-frame" src="../layouts/sidebar.html" title="Sidebar"></iframe>
<div class="main">
<div id="headerMount"></div>
<div class="content">
<div class="today-page-header">
<h1 class="today-page-title">مرضى اليوم</h1>
<p class="today-page-subtitle">قائمة المرضى المسجلين لليوم</p>
</div>
<div class="today-filters">
<div class="today-date-filter">
<label class="today-filter-label" for="todayDate">التاريخ</label>
<div class="today-date-input">
<div aria-label="اختيار التاريخ" class="today-date-icon" id="todayDateIcon" role="button" tabindex="0">
<img alt="" src="../assets/icons/date.svg"/>
</div>
<div aria-hidden="true" class="today-date-divider"></div>
<input class="today-date-field" id="todayDate" type="date"/>
</div>
</div>

<div class="today-search" style="width:280px;height:39px;">
  <input class="today-search-input" type="text" placeholder="ابحث باسم المريض أو رقم الهوية..."
    style="width:280px;height:39px;border:1px solid #053052;border-radius:5px;box-sizing:border-box;background:#FFFFFF;font-family:Inter, sans-serif;font-weight:400;font-size:14px;line-height:39px;text-align:center;color:#053052;outline:none;"/>
</div>
</div>
<div class="patients-table">
<div class="patients-table-header">
<div class="patients-th">اسم المريض</div>
<div class="patients-th">الرقم الوطني</div>
<div class="patients-th">الحالة</div>
<div class="patients-th">الإجراء</div>
</div>

<div class="patients-table-body" id="patientsTableBody">
<span aria-hidden="true" class="patients-vline v1"></span>
<span aria-hidden="true" class="patients-vline v2"></span>
<span aria-hidden="true" class="patients-vline v3"></span>
</div>
</div>

<div aria-label="ترقيم الصفحات" class="patients-pagination">
<button class="patients-page-nav" id="patientsPrev" type="button">
<span class="patients-page-text">السابق</span>
<span class="patients-page-arrow">→</span>
</button>
<div aria-label="أرقام الصفحات" class="patients-page-numbers" role="group">
<button class="patients-page-num is-active" data-page="1" type="button">١</button>
<button class="patients-page-num" data-page="2" type="button">٢</button>
<button class="patients-page-num" data-page="3" type="button">٣</button>
</div>
<button class="patients-page-nav" id="patientsNext" type="button">
<span class="patients-page-arrow">←</span>
<span class="patients-page-text">التالي</span>
</button>
</div>

<div aria-hidden="true" class="patient-modal-overlay" id="patientModalOverlay">
<div aria-label="تفاصيل المريض" aria-modal="true" class="patient-modal" role="dialog">
<h2 class="patient-modal-title">تفاصيل المريض</h2>
<div aria-hidden="true" class="patient-modal-divider"></div>

<div class="patient-modal-card">
<div class="patient-info-grid">
<div class="patient-info-item">
<div class="patient-info-label">اسم المريض</div>
<div class="patient-info-value" id="modalPatientName">—</div>
</div>
<div class="patient-info-item">
<div class="patient-info-label">رقم الهوية</div>
<div class="patient-info-value patient-info-value-90" id="modalNationalId">—</div>
</div>
<div class="patient-info-item">
<div class="patient-info-label">رقم الهاتف</div>
<div class="patient-info-value" id="modalPhone">—</div>
</div>
<div class="patient-info-item">
<div class="patient-info-label">النقاط المتبقية</div>
<div class="patient-info-value" id="modalPoints">—</div>
</div>
</div>
</div>

<div class="patient-modal-card patient-modal-card-lg">
<div aria-label="تبويبات تفاصيل المريض" class="patient-modal-tabs" role="tablist">
<button aria-selected="true" class="patient-modal-tab is-active" data-tab="overview" role="tab" type="button">نظرة عامة</button>
<button aria-selected="false" class="patient-modal-tab" data-tab="history" role="tab" type="button">سجل الصرف</button>
</div>
<div aria-hidden="true" class="patient-modal-tabs-divider"></div>

<div class="patient-modal-tabpanes">
<div class="patient-modal-tabpane is-active" data-pane="overview" role="tabpanel">
<div class="overview-cards">
<div class="overview-card overview-card-prescriptions">
<div class="overview-card-title">إجمالي الوصفات</div>
<div class="overview-card-value">١٢</div>
</div>
<div class="overview-card overview-card-meds">
<div class="overview-card-title">إجمالي الأدوية المصروفة</div>
<div class="overview-card-value">٣٥</div>
</div>
<div class="overview-card overview-card-points">
<div class="overview-card-title">إجمالي النقاط المستخدمة</div>
<div class="overview-card-value">٢,١٥٠</div>
</div>
<div aria-hidden="false" class="overview-last-visit">
<div class="last-visit-title">آخر زيارة</div>
<div class="last-visit-content">
<div class="last-visit-labels">
<div class="lv-label">التاريخ</div>
<div class="lv-label">المركز الطبي</div>
<div class="lv-label">الصيدلي</div>
</div>
<div class="last-visit-values">
<div class="lv-value lv-date">٢٠٢٥/٠١/٢٠</div>
<div class="lv-value lv-center">مستشفى غزة الأوروبي</div>
<div class="lv-value lv-pharmacist">أحمد محمود</div>
</div>
</div>
</div>
</div>
</div>
<div class="patient-modal-tabpane" data-pane="history" role="tabpanel">
<div class="history-title">سجل الأدوية المصروفة</div>
<div aria-label="سجل الأدوية المصروفة" class="history-table-wrap">
<table class="history-table">
<thead>
<tr>
<th class="w-drug">اسم الدواء</th>
<th class="w-qty">الكمية</th>
<th class="w-points">النقاط</th>
<th class="w-date">التاريخ</th>
<th class="w-pharm">الصيدلي</th>
</tr>
</thead>
<tbody id="historyTableBody">
<tr>
<td class="drug">باراسيتامول ٥٠٠ ملغ</td>
<td>١</td>
<td>٢٠</td>
<td>٢٠٢٥/١٢/٢٠</td>
<td class="pharm">أحمد محمود</td>
</tr>
<tr>
<td class="drug">أموكسيسيلين ٢٥٠ ملغ</td>
<td>٢</td>
<td>٤٠</td>
<td>٢٠٢٥/١٢/١٨</td>
<td class="pharm">أحمد محمود</td>
</tr>
<tr>
<td class="drug">إيبوبروفين ٤٠٠ ملغ</td>
<td>١</td>
<td>٣٠</td>
<td>٢٠٢٥/١٢/١٥</td>
<td class="pharm">أحمد محمود</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


<div class="patient-modal-footer">
  <button class="patient-modal-close" id="patientModalCloseBtn" type="button">إغلاق</button>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<script src="../js/include-header.js"></script>
<script src="../js/main.js"></script>
<script>
    // Open native date picker when clicking the icon
    (function () {
      const input = document.getElementById('todayDate');
      const icon = document.getElementById('todayDateIcon');

      if (!input || !icon) return;

      function openPicker() {
        if (typeof input.showPicker === 'function') {
          input.showPicker();
        } else {
          input.focus();
          input.click();
        }
      }

      icon.addEventListener('click', openPicker);
      icon.addEventListener('keydown', function (e) {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          openPicker();
        }
      });
    })();

    // Fake pagination + fake data (editable later)
    (function () {
      const tableBody = document.getElementById('patientsTableBody');
      const modalOverlay = document.getElementById('patientModalOverlay');
      const prevBtn = document.getElementById('patientsPrev');
      const nextBtn = document.getElementById('patientsNext');
      const pageBtns = Array.from(document.querySelectorAll('.patients-page-num'));

      if (!tableBody || !prevBtn || !nextBtn || pageBtns.length === 0) return;

      const pages = {
        1: [
          { name: 'أحمد يوسف حسن', nid: '٤٠١٢٣٤٥٦', status: 'green', statusText: 'تم الصرف' },
          { name: 'سارة خالد إبراهيم', nid: '٤٠٣٣٤٥٦٧', status: 'yellow', statusText: 'صرف جزئي' },
          { name: 'محمود عبد الله ناصر', nid: '٤٠٥٦٧٨٩', status: 'red', statusText: 'لم يصرف' },
          { name: 'فاطمة محمود علي', nid: '٤٠٣٤٥٦٧٨', status: 'green', statusText: 'تم الصرف' },
          { name: 'محمد أحمد شعبان', nid: '٤٠٥٦٧٨٩٠', status: 'green', statusText: 'تم الصرف' },
        ],
        2: [
          { name: 'آلاء سامي خليل', nid: '٤٠٧٧٨٨٩٩', status: 'yellow', statusText: 'صرف جزئي' },
          { name: 'خالد عمر ناصر', nid: '٤٠٢٢٣٣٤٤', status: 'green', statusText: 'تم الصرف' },
          { name: 'هدى محمود سالم', nid: '٤٠١١٩٩٠٠', status: 'red', statusText: 'لم يصرف' },
          { name: 'رامي إياد حسن', nid: '٤٠٦٦٥٥٤٤', status: 'green', statusText: 'تم الصرف' },
          { name: 'سلمى نادر علي', nid: '٤٠٣٠٣٠٣٠', status: 'yellow', statusText: 'صرف جزئي' },
        ],
        3: [
          { name: 'نور محمد عادل', nid: '٤٠٩٩٨٨٧٧', status: 'green', statusText: 'تم الصرف' },
          { name: 'يوسف طارق عبد', nid: '٤٠٨٨٧٧٦٦', status: 'red', statusText: 'لم يصرف' },
          { name: 'ليلى أحمد حمد', nid: '٤٠٢٣٢٣٢٣', status: 'yellow', statusText: 'صرف جزئي' },
          { name: 'إيهاب سامر سالم', nid: '٤٠٠١٠١٠١', status: 'green', statusText: 'تم الصرف' },
          { name: 'دعاء ناصر محمود', nid: '٤٠٤٤٣٣٢٢', status: 'red', statusText: 'لم يصرف' },
        ],
      };

      const totalPages = Object.keys(pages).length;
      let currentPage = 1;

      function statusClass(key) {
        if (key === 'green') return 'status-green';
        if (key === 'yellow') return 'status-yellow';
        return 'status-red';
      }

      function renderRows(pageNumber) {
        const vlines = Array.from(tableBody.querySelectorAll('.patients-vline'));
        tableBody.innerHTML = '';
        vlines.forEach(v => tableBody.appendChild(v));

        const rows = pages[pageNumber] || [];
        rows.forEach((row) => {
          const tr = document.createElement('div');
          tr.className = 'patients-tr';

          tr.innerHTML = `
            <div class="patients-td">${row.name}</div>
            <div class="patients-td">${row.nid}</div>
            <div class="patients-td"><div class="status-badge ${statusClass(row.status)}">${row.statusText}</div></div>
            <div class="patients-td patients-action-cell">
              <button type="button" class="patients-action-btn" aria-label="عرض تفاصيل المريض">
                <img src="../assets/icons/eye.svg" alt="">
              </button>
            </div>
          `;

          tableBody.appendChild(tr);
        });
      }

      function setActivePage(pageNumber) {
        currentPage = Math.min(Math.max(pageNumber, 1), totalPages);
        renderRows(currentPage);

        pageBtns.forEach((b) => b.classList.toggle('is-active', Number(b.dataset.page) === currentPage));

        const prevDisabled = currentPage === 1;
        const nextDisabled = currentPage === totalPages;

        prevBtn.classList.toggle('is-disabled', prevDisabled);
        nextBtn.classList.toggle('is-disabled', nextDisabled);
        prevBtn.setAttribute('aria-disabled', String(prevDisabled));
        nextBtn.setAttribute('aria-disabled', String(nextDisabled));
      }

      prevBtn.addEventListener('click', function () {
        if (currentPage === 1) return;
        setActivePage(currentPage - 1);
      });

      nextBtn.addEventListener('click', function () {
        if (currentPage === totalPages) return;
        setActivePage(currentPage + 1);
      });

      pageBtns.forEach((btn) => {
        btn.addEventListener('click', function () {
          const p = Number(btn.dataset.page);
          if (!Number.isFinite(p)) return;
          setActivePage(p);
        });
      });

      setActivePage(1);

      // ===== Modal: open on eye click (fill patient data) =====
      if (modalOverlay) {
        const elName = document.getElementById('modalPatientName');
        const elNid = document.getElementById('modalNationalId');
        const elPhone = document.getElementById('modalPhone');
        const elPoints = document.getElementById('modalPoints');

        function openModalWith(row) {
          if (elName) elName.textContent = row?.name || '—';
          if (elNid) elNid.textContent = row?.nid || '—';
          if (elPhone) elPhone.textContent = row?.phone || '٠٥٩١٢٣٤٥٦٧';
          if (elPoints) elPoints.textContent = row?.points || '٨٥٠';

          modalOverlay.classList.add('is-open');
          modalOverlay.setAttribute('aria-hidden', 'false');
          document.body.style.overflow = 'hidden';
        }

        function closeModal() {
          modalOverlay.classList.remove('is-open');
          modalOverlay.setAttribute('aria-hidden', 'true');
          document.body.style.overflow = '';
        }

        const closeBtn = document.getElementById('patientModalCloseBtn');
        if (closeBtn) closeBtn.addEventListener('click', closeModal);

        // Event delegation (rows are re-rendered)
        tableBody.addEventListener('click', function (e) {
          const btn = e.target.closest('.patients-action-btn');
          if (!btn) return;

          const tr = btn.closest('.patients-tr');
          const name = tr?.querySelectorAll('.patients-td')?.[0]?.textContent?.trim() || '';
          const nid = tr?.querySelectorAll('.patients-td')?.[1]?.textContent?.trim() || '';

          // Try to get full fake data object (editable later)
          const currentRows = pages[currentPage] || [];
          const found = currentRows.find(r => r.name === name && r.nid === nid);

          openModalWith(found || { name, nid, phone: '٠٥٩١٢٣٤٥٦٧', points: '٨٥٠' });
        });

        // Close when clicking outside the modal box
        modalOverlay.addEventListener('click', function (e) {
          if (e.target === modalOverlay) closeModal();
        });

        // Close on ESC
        document.addEventListener('keydown', function (e) {
          if (e.key === 'Escape' && modalOverlay.classList.contains('is-open')) {
            closeModal();
          }
        });
      }    })();

    // Modal tabs (Overview / History)
    (function () {
      const overlay = document.getElementById('patientModalOverlay');
      if (!overlay) return;

      const tabs = Array.from(overlay.querySelectorAll('.patient-modal-tab'));
      const panes = Array.from(overlay.querySelectorAll('.patient-modal-tabpane'));
      if (tabs.length === 0 || panes.length === 0) return;

      function activate(tabName) {
        tabs.forEach(t => {
          const isActive = t.getAttribute('data-tab') === tabName;
          t.classList.toggle('is-active', isActive);
          t.setAttribute('aria-selected', isActive ? 'true' : 'false');
        });
        panes.forEach(p => {
          const isActive = p.getAttribute('data-pane') === tabName;
          p.classList.toggle('is-active', isActive);
        });
      }

      tabs.forEach(t => {
        t.addEventListener('click', () => activate(t.getAttribute('data-tab')));
      });
    })();
</script>
</body>
</html>
